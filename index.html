<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title></title>
  <link href="style.css" rel="stylesheet" />
</head>

<body>
  <div class="wpb_raw_code wpb_content_element wpb_raw_html">
    <div class="wpb_wrapper">
      <div class="videoBlock">
        <video onmouseover="this.play()" onmouseout="this.pause();this.currentTime=0;" width="320" height="180" muted>
          <source class='source' src="" type="video/mp4" />
        </video>
        <!-- <div class="playpause"></div> -->
      </div>
    </div>
  </div>

  <div class="more_projects">
    <h2 class="more_projects__title">Больше проектов</h2>
    <div class="more_projects__button"></div>
  </div>

  <!-- <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script> -->
  <script>
    const tabs = {
      all: 'all',
      logo: 'logo',
      intro: 'intro',
      exp: 'exp',
      pres: 'pres',
      adv: 'adv',
    }

    const contentArr = [
      {
        src: "https://paperfox.studio/wp-content/uploads/2022/05/CM_1920x1080_sound_v015.mp4",
        tab: 'logo',
      },
      {
        src: "https://paperfox.studio/wp-content/uploads/2022/05/Sun_school_logo_1080x1920_7s.mp4",
        tab: 'intro',
      },
      {
        src: "https://paperfox.studio/wp-content/uploads/2022/05/Chiken_1080x1920.mp4",
        tab: 'exp',
      },
      {
        src: "https://paperfox.studio/wp-content/uploads/2022/05/Alena_Shakh_intro_color2_psy.mp4",
        tab: 'pres',
      },
      {
        src: "https://paperfox.studio/wp-content/uploads/2019/12/Kygo-Happy-Now-ft.-Sandro-Cavazza-Official-Video.mp4",
        tab: 'adv',
      },
      {
        src: "https://paperfox.studio/wp-content/uploads/2019/12/Avicii-Waiting-For-Love.mp4",
        tab: 'logo',
      },
      {
        src: "https://paperfox.studio/wp-content/uploads/2020/01/video1.mp4",
        tab: 'intro',
      },
      {
        src: "https://paperfox.studio/wp-content/uploads/2019/11/Death_to_Stock_Get-Down_1_x264.webm",
        tab: 'exp',
      },
      {
        src: "https://paperfox.studio/wp-content/uploads/2022/05/CM_1920x1080_sound_v015.mp4",
        tab: 'pres',
      },
      {
        src: "https://paperfox.studio/wp-content/uploads/2022/05/Sun_school_logo_1080x1920_7s.mp4",
        tab: 'adv',
      },
      {
        src: "https://paperfox.studio/wp-content/uploads/2022/05/CM_1920x1080_sound_v015.mp4",
        tab: 'logo',
      },
      {
        src: "https://paperfox.studio/wp-content/uploads/2022/05/Sun_school_logo_1080x1920_7s.mp4",
        tab: 'intro',
      },
      {
        src: "https://paperfox.studio/wp-content/uploads/2022/05/Chiken_1080x1920.mp4",
        tab: 'exp',
      },
      {
        src: "https://paperfox.studio/wp-content/uploads/2022/05/Alena_Shakh_intro_color2_psy.mp4",
        tab: 'pres',
      },
      {
        src: "https://paperfox.studio/wp-content/uploads/2019/12/Kygo-Happy-Now-ft.-Sandro-Cavazza-Official-Video.mp4",
        tab: 'adv',
      },
      {
        src: "https://paperfox.studio/wp-content/uploads/2019/12/Avicii-Waiting-For-Love.mp4",
        tab: 'logo',
      },
      {
        src: "https://paperfox.studio/wp-content/uploads/2020/01/video1.mp4",
        tab: 'intro',
      },
      {
        src: "https://paperfox.studio/wp-content/uploads/2019/11/Death_to_Stock_Get-Down_1_x264.webm",
        tab: 'exp',
      },
      {
        src: "https://paperfox.studio/wp-content/uploads/2022/05/CM_1920x1080_sound_v015.mp4",
        tab: 'pres',
      },
      {
        src: "https://paperfox.studio/wp-content/uploads/2022/05/Sun_school_logo_1080x1920_7s.mp4",
        tab: 'adv',
      },
      {
        src: "https://paperfox.studio/wp-content/uploads/2022/05/CM_1920x1080_sound_v015.mp4",
        tab: 'logo',
      },
      {
        src: "https://paperfox.studio/wp-content/uploads/2022/05/Sun_school_logo_1080x1920_7s.mp4",
        tab: 'intro',
      },
      {
        src: "https://paperfox.studio/wp-content/uploads/2022/05/Chiken_1080x1920.mp4",
        tab: 'exp',
      },
      {
        src: "https://paperfox.studio/wp-content/uploads/2022/05/Alena_Shakh_intro_color2_psy.mp4",
        tab: 'pres',
      },
      {
        src: "https://paperfox.studio/wp-content/uploads/2019/12/Kygo-Happy-Now-ft.-Sandro-Cavazza-Official-Video.mp4",
        tab: 'adv',
      },
      {
        src: "https://paperfox.studio/wp-content/uploads/2019/12/Avicii-Waiting-For-Love.mp4",
        tab: 'logo',
      },
      {
        src: "https://paperfox.studio/wp-content/uploads/2020/01/video1.mp4",
        tab: 'intro',
      },
      {
        src: "https://paperfox.studio/wp-content/uploads/2019/11/Death_to_Stock_Get-Down_1_x264.webm",
        tab: 'exp',
      },
      {
        src: "https://paperfox.studio/wp-content/uploads/2022/05/CM_1920x1080_sound_v015.mp4",
        tab: 'pres',
      },
      {
        src: "https://paperfox.studio/wp-content/uploads/2022/05/Sun_school_logo_1080x1920_7s.mp4",
        tab: 'adv',
      },

    ];

    const parent = document.querySelector(
      ".wpb_raw_code.wpb_content_element.wpb_raw_html > .wpb_wrapper"
    );
    const videoEl = document.querySelector(".videoBlock");

    const parentWidth = parent.offsetWidth;
    const videoElWidth = videoEl.offsetWidth;
    const columns = Math.floor(parentWidth / videoElWidth);
    const maxLoadCount = columns * 2 - 1;
    let loadedItems = 0;

    const loadButton = document.querySelector(".more_projects__button");
    const loadMoreContainer = document.querySelector(".more_projects");

    // let prevCurTab = document.querySelector('.vc_tta-tab.vc_active .vc_tta-title-text')?.innerHTML || 'Все'
    let prevCurTab = document.querySelector('.vc_tta-tab.vc_active .vc_tta-title-text').innerHTML

    const setCurTabListeners = () => {
      const allTabs = document.querySelectorAll('.vc_tta-tab a')
      allTabs.forEach(element => {
        element.addEventListener('click', () => {
          const curTab = element.querySelector('.vc_tta-title-text').innerHTML
          console.log(prevCurTab, curTab);
          if (prevCurTab != curTab) {
            prevCurTab = curTab
            loadedItems = 0
            loadContent(loadedItems, maxLoadCount, curTab)
          }
        })
      });
    }

    function loadContent(start, maxLoadCount, targetTab) {

      const videoElAll = document.querySelectorAll(".videoBlock");
      const lastVideo = videoElAll[videoElAll.length - 1]
      const sourceAll = document.querySelectorAll(".source");
      const lastSource = sourceAll[sourceAll.length - 1]

      const renderArr = contentArr.filter(el => el.tab == targetTab)

      for (let i = start; i < start + maxLoadCount + 1; i++) {
        if (contentArr[i]) {
          // const source = document.querySelector("source");      
          // console.log(i);
          lastSource.src = contentArr[i].src;
          lastSource.id = i
          // console.log(lastSource.src);
          const clone = lastVideo.cloneNode(true);
          parent.appendChild(clone);
          loadedItems++;

        }
        if (loadedItems >= contentArr.length) {
          loadMoreContainer.classList.add('hidden')
        }
      }
    }

    setCurTabListeners()

    loadContent(loadedItems, maxLoadCount);

    loadButton.addEventListener("click", () => {
      loadContent(loadedItems, maxLoadCount);
    });

    videoEl.remove()

      // const videoElAll = document.querySelectorAll(".videoBlock");
      // console.log('videoElAll', videoElAll);

      // const allPlaypause = document.querySelectorAll('.playpause')
      // for (let i = 0; i < allPlaypause.length; i++) {
      //   function toggleClass(event) {

      //     event.stopPropagation();
      //     event.preventDefault();
      //     console.log('out');
      //     allPlaypause[i].classList.toggle('hidden')
      //   }
      //   allPlaypause[i].addEventListener("mouseover", toggleClass)
      //   allPlaypause[i].addEventListener("mouseout", toggleClass)
      // }
  </script>
</body>

</html>